# NewLife.XCode 更新日志

## v11.24.2026.0102 (2026-01-02)

### 新功能
- **数据权限体系**：引入多维度数据访问控制，支持多租户数据隔离与安全性
  - 支持租户级、部门级、用户级等多维度数据权限
  - 完善数据权限上下文及菜单级权限支持
  - 重构数据权限过滤逻辑与QueryAction枚举
  - 新增数据权限文档与单元测试覆盖
  - 完善租户相关单元测试
  - 只能操作本租户数据，提升数据隔离
- **实体拦截器重构**：统一实体模块为拦截器机制，提升扩展性
  - EntityBuilder支持XCode模块名称自动升级
  - 增强拦截器注释与结构，提升健壮性
  - 重构实体拦截器字段为EntityModules类型
  - 重构模块命名为拦截器并自动升级旧代码
- **模型文件版本管理**：支持模型文件版本号与自动升级机制
  - 检测旧版本文件并自动升级
  - 增强Version属性赋值处理
  - 支持ChineseFileName自动升级
- **会员功能扩展**：
  - Member表新增类型、数据范围等核心字段
  - 扩展Value字段长度至500
  - Department新增FindByCode查询方法
  - 会员核心表字段补全与类型规范，增强查询能力
- **配置增强**：
  - 优化DAL配置提供者绑定，支持ServiceProvider注入
  - 参数配置支持长文本，优化存储与读取逻辑
- **地区数据更新**：从PluginServer下载民政部最新地区数据
- **菜单数据范围**：使用枚举管理菜单数据范围

### 重要修复
- **[fix]** 修复数据库注释特殊字符导致的SQL错误
- **[fix]** 修复DateTime默认值SQL生成未加引号的问题，避免被误解析为数学表达式
- **[fix]** 修复数据库驱动加载失败时的处理，失败时删除后重新下载
- **[fix]** 修复批量插入实体列表时顺序不一致的问题（Valid内生成雪花Id需确保插入顺序）

### 性能优化
- 引入AsArray，借助数组优化多线程修改集合问题

### 代码质量改进
- **空引用安全**：
  - 支持可空引用类型，提升空值安全性和健壮性
  - DDL方法可空化，接口兼容性提升
  - 提升空引用安全与健壮性，优化类型与判空处理
  - 支持可空引用类型与集合初始化现代化
- **数据库兼容性**：
  - 增强MySQL SslMode兼容性，支持新版驱动枚举
  - 优化CI测试环境及数据库单元测试兼容性
  - 恢复SQLite文件时增加埋点
- **链路追踪**：增强数据库检查链路追踪与日志记录

### 文档与工具
- **协作指令**：重构XCode协作指令文档并新增使用手册
- **指令文件部署**：重构部署方式，移除props，新增targets
- **CI/CD**：删除中间临时文件，优化发布流程
- **XCodeTool**：注释掉ChineseFileName选项赋值

### 依赖更新
- 多次Upgrade Nuget包到最新版本

### 破坏性变更
无

---

## v11.23.2026.0102 (2026-01-02)

修正延迟队列更新的BUG；优化大量对象缓存的并发查询；梳理重构Merge逻辑



