# XCode æ•°æ®æ¨¡å‹ä¸ç»“æ„åŒæ­¥

## æ¦‚è¿°

**XCode** æ˜¯æ–°ç”Ÿå‘½å›¢é˜Ÿå¼€å‘çš„ .NET æ•°æ®ä¸­é—´ä»¶ï¼Œæä¾› ORMã€ç¼“å­˜ã€åˆ†è¡¨åˆ†åº“ã€æ•°æ®åŒæ­¥ç­‰å¤šç§æ•°æ®è®¿é—®èƒ½åŠ›ã€‚æœ¬æ–‡æ¡£èšç„¦äº XCode çš„**æ•°æ®æ¨¡å‹ç®¡ç†**ä¸**æ•°æ®åº“ç»“æ„åŒæ­¥**æœºåˆ¶ã€‚

> **å›½äº§åŸåˆ›**ï¼šXCode å®Œå…¨ç”±å›½äººå¼€å‘ï¼Œæœªå¼•ç”¨ä»»ä½•ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œä»åº•å±‚åˆ°ä¸Šå±‚å…¨éƒ¨è‡ªä¸»å®ç°ã€‚

### XCode çš„æ•°æ®è®¿é—®èƒ½åŠ›

é™¤äº†å¼ºç±»å‹å®ä½“æ“ä½œå¤–ï¼ŒXCode è¿˜æ”¯æŒï¼š
- **ä»»æ„å®ä½“æ¨¡å‹çš„å¢åˆ æ”¹æŸ¥**ï¼šæ”¯æŒæ‰§è¡Œä»»æ„ SQL å¹¶æ˜ å°„åˆ°ä»»æ„å®ä½“æ¨¡å‹ï¼Œå®Œå…¨å…¼å®¹ Dapper ç”¨æ³•
- **å¤šçº§ç¼“å­˜**ï¼šå®ä½“ç¼“å­˜ã€å¯¹è±¡ç¼“å­˜ã€å…¨è¡¨ç¼“å­˜ï¼Œè‡ªåŠ¨æ›´æ–°
- **è¯»å†™åˆ†ç¦»**ï¼šè‡ªåŠ¨è¯†åˆ«è¯»å†™æ“ä½œï¼Œè·¯ç”±åˆ°ä¸»ä»åº“
- **é“¾è·¯è¿½è¸ª**ï¼šå†…ç½®åŸ‹ç‚¹ï¼Œæ”¯æŒ OpenTelemetry ç­‰ APM ç³»ç»Ÿ

### æ ¸å¿ƒæ¦‚å¿µ

XCode ä½¿ç”¨ **IDataTable/IDataColumn/IDataIndex** æ¥å£ä½“ç³»æ¥æè¿°æ•°æ®åº“ç»“æ„ï¼Œè¿™æ˜¯æ•´ä¸ªå…ƒæ•°æ®ç®¡ç†çš„æ ¸å¿ƒï¼š

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   IDataTable    â”‚  â† æ ¸å¿ƒï¼šè¡”æ¥æ‰€æœ‰éƒ¨ä½
                    â”‚   IDataColumn   â”‚
                    â”‚   IDataIndex    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
        â†“                    â†“                    â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ æ•°æ®åº“  â”‚         â”‚  XML    â”‚         â”‚ å®ä½“ç±»  â”‚
   â”‚ æ­£å‘è¯»å– â”‚         â”‚ æŒä¹…åŒ–  â”‚         â”‚ ç‰¹æ€§æå– â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**IDataTable æ˜¯çœŸæ­£çš„æ ¸å¿ƒ**ï¼š
- æ­£å‘å·¥ç¨‹ä»æ•°æ®åº“è¯»å–ç»“æ„ï¼Œè½¬æ¢ä¸º IDataTable
- åå‘å·¥ç¨‹ä»å®ä½“ç±»æå–ç‰¹æ€§ï¼Œæ„å»º IDataTableï¼Œå†åŒæ­¥åˆ°æ•°æ®åº“
- XML æ¨¡å‹æ–‡ä»¶åªæ˜¯ IDataTable çš„ä¸€ç§æŒä¹…åŒ–å½¢å¼
- ä»£ç ç”Ÿæˆå™¨è¯»å– XMLï¼ˆå³ IDataTable çš„æŒä¹…åŒ–ï¼‰ï¼Œç”Ÿæˆå®ä½“ç±»

### æ­£å‘å·¥ç¨‹ä¸åå‘å·¥ç¨‹

| å·¥ç¨‹ç±»å‹ | æ•°æ®æµå‘ | æ ¸å¿ƒæ–¹æ³• |
|---------|---------|---------|
| **æ­£å‘å·¥ç¨‹** | æ•°æ®åº“ â†’ IDataTable â†’ XML/å®ä½“ç±» | `DbMetaData.GetTables()` |
| **åå‘å·¥ç¨‹** | å®ä½“ç±» â†’ IDataTable â†’ æ•°æ®åº“ | `DbMetaData.SetTables()` |

---

## ä¸€ã€IDataTable æ¨¡å‹ä½“ç³»

### 1.1 æ ¸å¿ƒæ¥å£

```csharp
// è¡¨ç»“æ„
public interface IDataTable : ICloneable
{
    String Name { get; set; }           // å®ä½“ç±»å
    String TableName { get; set; }      // æ•°æ®åº“è¡¨å
    String? ConnName { get; set; }      // è¿æ¥å
    DatabaseType DbType { get; set; }   // æ•°æ®åº“ç±»å‹
    List<IDataColumn> Columns { get; }  // å­—æ®µé›†åˆ
    List<IDataIndex> Indexes { get; }   // ç´¢å¼•é›†åˆ
}

// å­—æ®µç»“æ„
public interface IDataColumn
{
    String Name { get; set; }           // å±æ€§å
    String ColumnName { get; set; }     // æ•°æ®åº“åˆ—å
    Type DataType { get; set; }         // .NET ç±»å‹
    String? RawType { get; set; }       // æ•°æ®åº“åŸå§‹ç±»å‹
    Boolean Identity { get; set; }      // è‡ªå¢
    Boolean PrimaryKey { get; set; }    // ä¸»é”®
    Int32 Length { get; set; }          // é•¿åº¦
    Boolean Nullable { get; set; }      // å…è®¸ç©º
}

// ç´¢å¼•ç»“æ„
public interface IDataIndex
{
    String Name { get; set; }           // ç´¢å¼•å
    String[] Columns { get; set; }      // å­—æ®µåˆ—è¡¨
    Boolean Unique { get; set; }        // å”¯ä¸€ç´¢å¼•
}
```

### 1.2 å®ä½“ç±»ç‰¹æ€§ä¸ IDataTable çš„å…³ç³»

ä»£ç ç”Ÿæˆå™¨æ ¹æ® IDataTable ç”Ÿæˆå®ä½“ç±»ï¼Œåœ¨ç±»å’Œå±æ€§ä¸Šæ·»åŠ ç‰¹æ€§ï¼š

```csharp
[BindTable("User", Description = "ç”¨æˆ·", ConnName = "Membership", DbType = DatabaseType.MySql)]
[BindIndex("IX_User_Name", true, "Name")]
public partial class User : Entity<User>
{
    [BindColumn("ID", Identity = true, PrimaryKey = true)]
    public Int32 ID { get; set; }
    
    [BindColumn("Name", Master = true, Length = 50)]
    public String Name { get; set; }
}
```

è¿è¡Œæ—¶ï¼ŒXCode é€šè¿‡åå°„æå–è¿™äº›ç‰¹æ€§ï¼Œé‡æ–°æ„å»º IDataTableï¼Œç”¨äºåå‘å·¥ç¨‹ã€‚

### 1.3 TableItem vs IDataTable

| ç‰¹æ€§ | TableItem | IDataTable |
|------|-----------|------------|
| **æ¥æº** | åå°„å®ä½“ç±»ç‰¹æ€§ | ä» TableItem æ„å»ºæˆ–ä»æ•°æ®åº“è¯»å– |
| **å¯å˜æ€§** | **ä¸å¯å˜**ï¼ˆç¼–è¯‘æ—¶å›ºå®šï¼‰ | **å¯å˜**ï¼ˆè¿è¡Œæ—¶å¯ä¿®æ”¹ï¼‰ |
| **ç”¨é€”** | è®°å½•å®ä½“ç±»çš„åŸå§‹ç»‘å®š | æ‰§è¡Œæ­£å‘/åå‘å·¥ç¨‹ |

**è®¾è®¡ç†å¿µ**ï¼šTableItem æ˜¯"åŸå§‹è®¾å®š"ï¼ŒIDataTable æ˜¯"å·¥ä½œå‰¯æœ¬"ã€‚é€šè¿‡è¿™ç§åˆ†ç¦»ï¼Œå®ç°ä¸€ä¸ªå®ä½“ç±»åŠ¨æ€æ˜ å°„åˆ°ä¸åŒè¡¨å/æ•°æ®åº“çš„èƒ½åŠ›ã€‚

---

## äºŒã€ç±»å‹æ˜ å°„ä½“ç³»

æ¯ç§æ•°æ®åº“éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ .NET ç±»å‹ä¸æ•°æ®åº“ç±»å‹çš„åŒå‘æ˜ å°„è§„åˆ™ã€‚

### 2.1 æ˜ å°„è¡¨ç»“æ„

```csharp
// æ¯ä¸ªæ•°æ®åº“é©±åŠ¨å®šä¹‰è‡ªå·±çš„ Types æ˜ å°„è¡¨
protected IDictionary<Type, String[]> Types { get; set; }
```

### 2.2 å„æ•°æ®åº“æ˜ å°„ç¤ºä¾‹

| .NET ç±»å‹ | MySQL | SQLite | SQL Server | Oracle | PostgreSQL |
|----------|-------|--------|------------|--------|------------|
| String | varchar, longtext | nvarchar, text | nvarchar, nvarchar(max) | varchar2, clob | varchar, text |
| Int32 | int | integer | int | number(10) | integer |
| Int64 | bigint | integer | bigint | number(19) | bigint |
| Boolean | tinyint(1) | boolean | bit | number(1) | boolean |
| DateTime | datetime | datetime | datetime | date | timestamp |
| Decimal | decimal | decimal | decimal | number | numeric |
| Byte[] | blob | blob | varbinary | blob | bytea |

### 2.3 RawType çš„ä½œç”¨

`RawType` è®°å½•å­—æ®µåœ¨æºæ•°æ®åº“ä¸­çš„åŸå§‹ç±»å‹ï¼Œç”¨äºè·¨åº“éƒ¨ç½²æ—¶çš„æœ€ä½³å…¼å®¹ï¼š

```
åœºæ™¯ï¼šå®ä½“ç±»åœ¨ MySQL ç”Ÿæˆï¼Œéƒ¨ç½²åˆ°ä¸åŒæ•°æ®åº“

MySQL ç”Ÿäº§ç¯å¢ƒï¼šDbType=MySql â†’ ä½¿ç”¨ RawType="varchar(50)"ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰
SQLite æµ‹è¯•ç¯å¢ƒï¼šDbTypeâ‰ MySql â†’ é‡æ–°æ˜ å°„ä¸º nvarchar(50)
```

---

## ä¸‰ã€æ­£å‘å·¥ç¨‹

æ­£å‘å·¥ç¨‹ä»æ•°æ®åº“è¯»å–è¡¨ç»“æ„ï¼Œç”Ÿæˆ IDataTableã€‚

### 3.1 æµç¨‹

```
æ•°æ®åº“
  â”‚
  â”‚ GetSchema("Tables"/"Columns"/"Indexes")
  â†“
DataRow[] â”€â”€â†’ è§£æ â”€â”€â†’ IDataTable
                          â”‚
                          â”œâ”€â”€â†’ DAL.Export() â”€â”€â†’ XML æ–‡ä»¶
                          â””â”€â”€â†’ XCodeTool â”€â”€â†’ å®ä½“ç±»ä»£ç 
```

### 3.2 æ ¸å¿ƒå®ç°

```csharp
// DbMetaData_Positive.cs
public IList<IDataTable> GetTables()
{
    // 1. è·å–è¡¨åˆ—è¡¨
    var dt = GetSchema("Tables", null);
    
    // 2. éå†æ¯ä¸ªè¡¨
    foreach (var row in dt.Rows)
    {
        var table = new XTable();
        table.TableName = row["TABLE_NAME"];
        
        // 3. è·å–å­—æ®µ
        table.Columns = GetFields(table);
        
        // 4. è·å–ç´¢å¼•
        table.Indexes = GetIndexes(table);
    }
}
```

---

## å››ã€åå‘å·¥ç¨‹

åå‘å·¥ç¨‹ä»å®ä½“ç±»çš„ IDataTable ä¸æ•°æ®åº“ç°æœ‰ç»“æ„å¯¹æ¯”ï¼Œè‡ªåŠ¨æ‰§è¡Œ DDL æ“ä½œã€‚

### 4.1 æµç¨‹

```
å®ä½“ç±»ç‰¹æ€§ â”€â”€â†’ TableItem â”€â”€â†’ IDataTable (å®ä½“)
                                  â”‚
                                  â”‚ å¯¹æ¯”
                                  â†“
æ•°æ®åº“ â”€â”€â†’ GetTables() â”€â”€â†’ IDataTable (æ•°æ®åº“)
                                  â”‚
                                  â”‚ å·®å¼‚æ£€æµ‹
                                  â†“
                           ç”Ÿæˆå¹¶æ‰§è¡Œ DDL
```

### 4.2 Migration æ¨¡å¼

| æ¨¡å¼ | å»ºè¡¨ | åŠ å­—æ®µ | æ”¹å­—æ®µ | åˆ å­—æ®µ | åŠ ç´¢å¼• | åˆ ç´¢å¼• | é€‚ç”¨åœºæ™¯ |
|------|------|--------|--------|--------|--------|--------|---------|
| Off | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | ç”Ÿäº§ç¯å¢ƒï¼ˆæ‰‹å·¥ç®¡ç†ï¼‰ |
| ReadOnly | ğŸ“ | ğŸ“ | ğŸ“ | ğŸ“ | ğŸ“ | ğŸ“ | ç”Ÿäº§ç¯å¢ƒï¼ˆå®¡æ ¸ SQLï¼‰ |
| OnlyCreate | âœ… | âœ… | âŒ | âŒ | âœ… | âŒ | ç”Ÿäº§ç¯å¢ƒï¼ˆå®‰å…¨æ¨¡å¼ï¼‰ |
| Full | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | å¼€å‘ç¯å¢ƒ |

*ğŸ“ = ä»…è¾“å‡º SQLï¼Œä¸æ‰§è¡Œ*

### 4.3 DDL æ“ä½œç±»å‹

- **æ•°æ®åº“**ï¼šCreateDatabaseã€DatabaseExist
- **è¡¨**ï¼šCreateTableã€DropTableã€AddTableDescription
- **å­—æ®µ**ï¼šAddColumnã€AlterColumnã€DropColumnã€AddColumnDescription
- **ç´¢å¼•**ï¼šCreateIndexã€DropIndex

### 4.4 ä¸ä¸»æµ ORM/æ•°æ®ä¸­é—´ä»¶å¯¹æ¯”

#### ç»“æ„åŒæ­¥æœºåˆ¶å¯¹æ¯”

| ç‰¹æ€§ | XCode | EF Core | FreeSql | SqlSugar | Dapper |
|------|-------|---------|---------|----------|--------|
| **æ­£å‘å·¥ç¨‹** | âœ… å†…ç½® | âœ… Scaffold | âœ… DbFirst | âœ… DbFirst | âŒ æ—  |
| **åå‘å·¥ç¨‹** | âœ… è¿è¡Œæ—¶è‡ªåŠ¨ | âœ… Migration æ–‡ä»¶ | âœ… CodeFirst | âœ… CodeFirst | âŒ æ—  |
| **è¿ç§»æ–‡ä»¶** | ä¸éœ€è¦ | éœ€è¦ | å¯é€‰ | å¯é€‰ | - |
| **è¿è¡Œæ—¶å¯¹æ¯”** | âœ… è‡ªåŠ¨ | âŒ éœ€æ˜¾å¼è°ƒç”¨ | âœ… å¯é…ç½® | âœ… å¯é…ç½® | - |
| **å·®å¼‚æ£€æµ‹** | å­—æ®µçº§ | æ¨¡å‹çº§ | å­—æ®µçº§ | å­—æ®µçº§ | - |
| **å›æ»šæ”¯æŒ** | âŒ | âœ… | âŒ | âŒ | - |

#### è·¨æ•°æ®åº“èƒ½åŠ›å¯¹æ¯”

| ç‰¹æ€§ | XCode | EF Core | FreeSql | SqlSugar | Dapper |
|------|-------|---------|---------|----------|--------|
| **æ”¯æŒæ•°æ®åº“æ•°** | 10+ | 10+ | 15+ | 10+ | ä»»æ„ |
| **ç±»å‹è‡ªåŠ¨æ˜ å°„** | âœ… | âœ… | âœ… | âœ… | âŒ æ‰‹å†™ |
| **åŒä¸€æ¨¡å‹è·¨åº“** | âœ… åŸç”Ÿ | éœ€åˆ‡æ¢ Provider | âœ… | âœ… | æ‰‹å†™ |
| **RawType ä¿ç•™** | âœ… | âŒ | âŒ | âŒ | - |

#### åˆ†è¡¨åˆ†åº“èƒ½åŠ›å¯¹æ¯”

| ç‰¹æ€§ | XCode | EF Core | FreeSql | SqlSugar | ShardingSphere |
|------|-------|---------|---------|----------|----------------|
| **åˆ†è¡¨æ”¯æŒ** | âœ… åŸç”Ÿ | éœ€ç¬¬ä¸‰æ–¹ | âœ… åŸç”Ÿ | âœ… åŸç”Ÿ | âœ… åŸç”Ÿ |
| **åˆ†åº“æ”¯æŒ** | âœ… åŸç”Ÿ | éœ€å¤š Context | âœ… åŸç”Ÿ | âœ… åŸç”Ÿ | âœ… åŸç”Ÿ |
| **è¿è¡Œæ—¶åˆ‡æ¢** | âœ… ä»»æ„æ—¶åˆ» | éœ€é‡å»º Context | âœ… | âœ… | âœ… |
| **è‡ªåŠ¨å»ºè¡¨** | âœ… | âŒ | âœ… | âœ… | âŒ |
| **æ—¶é—´åˆ†è¡¨ç­–ç•¥** | âœ… å†…ç½® | âŒ | âœ… å†…ç½® | âœ… å†…ç½® | âœ… é…ç½® |

#### è®¾è®¡ç†å¿µå·®å¼‚

| æ¡†æ¶ | å®šä½ | ç»“æ„ç®¡ç†ç†å¿µ | å›½äº§ |
|------|------|-------------|------|
| **XCode** | æ•°æ®ä¸­é—´ä»¶ | è¿è¡Œæ—¶è‡ªåŠ¨åŒæ­¥ï¼Œé›¶è¿ç§»æ–‡ä»¶ï¼ŒåŠ¨æ€çµæ´» | âœ… åŸåˆ› |
| **EF Core** | é‡é‡çº§ ORM | è¿ç§»æ–‡ä»¶ç‰ˆæœ¬ç®¡ç†ï¼Œå†å²å¯è¿½æº¯ï¼Œå›¢é˜Ÿåä½œ | âŒ |
| **FreeSql** | è½»é‡çº§ ORM | å…¼é¡¾è‡ªåŠ¨åŒæ­¥ä¸è¿ç§»æ–‡ä»¶ï¼Œçµæ´»å¯é€‰ | âœ… |
| **SqlSugar** | è½»é‡çº§ ORM | è‡ªåŠ¨åŒæ­¥ä¸ºä¸»ï¼Œç®€å•æ˜“ç”¨ | âœ… |
| **Dapper** | å¾®å‹ ORM | ä¸ç®¡ç†ç»“æ„ï¼Œä¸“æ³¨ SQL æ‰§è¡Œ | âŒ |
| **ShardingSphere** | åˆ†å¸ƒå¼ä¸­é—´ä»¶ | ä¸“æ³¨åˆ†ç‰‡è·¯ç”±ï¼Œä¸ç®¡ç†è¡¨ç»“æ„ | âœ… |

#### XCode çš„ç‹¬ç‰¹ä¼˜åŠ¿

1. **å›½äº§åŸåˆ›**ï¼šå®Œå…¨ç”±å›½äººå¼€å‘ï¼Œæœªå¼•ç”¨ä»»ä½•ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œè‡ªä¸»å¯æ§
2. **IDataTable ä¸­é—´å±‚**ï¼šç»Ÿä¸€çš„æ¨¡å‹æŠ½è±¡ï¼Œè¡”æ¥æ•°æ®åº“ã€XMLã€å®ä½“ç±»
3. **RawType æœºåˆ¶**ï¼šä¿ç•™åŸå§‹æ•°æ®åº“ç±»å‹ï¼Œè·¨åº“éƒ¨ç½²æ—¶ç²¾ç¡®åŒ¹é…
4. **è¿è¡Œæ—¶å®Œå…¨å¯å˜**ï¼šè¡¨åã€è¿æ¥åã€å­—æ®µä¿¡æ¯å‡å¯åŠ¨æ€ä¿®æ”¹
5. **æ­£åå‘ä¸€ä½“**ï¼šåŒä¸€å¥— IDataTable ä½“ç³»æ”¯æ’‘æ­£å‘å’Œåå‘å·¥ç¨‹
6. **å…¼å®¹ Dapper ç”¨æ³•**ï¼šæ”¯æŒä»»æ„ SQL æ˜ å°„åˆ°ä»»æ„å®ä½“ï¼ŒåŒæ—¶å…·å¤‡ç¼“å­˜ã€è¯»å†™åˆ†ç¦»ã€åŸ‹ç‚¹èƒ½åŠ›

---

## äº”ã€åŠ¨æ€åˆ†è¡¨åˆ†åº“

XCode çš„ä¸€å¤§äº®ç‚¹æ˜¯æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹è¿æ¥åã€è¡¨åã€å­—æ®µä¿¡æ¯ï¼Œè¿™æ˜¯å®ç°åˆ†è¡¨åˆ†åº“çš„åŸºç¡€ã€‚

### 5.1 è®¾è®¡åŸç†

```
TableItem (ä¸å¯å˜)          IDataTable (å¯å˜)
     â”‚                           â”‚
     â”‚ ç¼–è¯‘æ—¶å›ºå®š                â”‚ è¿è¡Œæ—¶å¯ä¿®æ”¹
     â”‚ TableName="Log"          â”‚ TableName="Log_202602"
     â”‚ ConnName="Main"          â”‚ ConnName="Shard_01"
     â”‚                           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ„å»º â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â†“
                          åå‘å·¥ç¨‹ä½¿ç”¨ä¿®æ”¹åçš„å€¼
```

### 5.2 åˆ†è¡¨ç¤ºä¾‹

```csharp
// æŒ‰æœˆåˆ†è¡¨
var tableName = $"Log_{DateTime.Now:yyyyMM}";  // Log_202602

// ä¿®æ”¹ IDataTable
var dt = TableItem.Create(typeof(Log)).DataTable;
dt.TableName = tableName;

// ç¡®ä¿è¡¨å­˜åœ¨
DAL.Create("Main").SetTables(Migration.OnlyCreate, dt);
```

### 5.3 åˆ†åº“ç¤ºä¾‹

```csharp
// æ ¹æ®ç”¨æˆ· ID é€‰æ‹©åˆ†åº“
var shardIndex = userId % 4;
var connName = $"Shard_{shardIndex:D2}";  // Shard_00 ~ Shard_03

// åˆ‡æ¢è¿æ¥
User.Meta.ConnName = connName;
```

### 5.4 å†…ç½®åˆ†è¡¨ç­–ç•¥

XCode æä¾›äº† `TimeShardPolicy` ç­‰å†…ç½®åˆ†è¡¨ç­–ç•¥ï¼Œè‡ªåŠ¨å¤„ç†è¡¨åè®¡ç®—å’Œè¡¨ç»“æ„åˆ›å»ºã€‚

---

## å…­ã€æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|-----|------|
| `DataAccessLayer\Model\IDataTable.cs` | è¡¨ç»“æ„æ¥å£ï¼ˆæ ¸å¿ƒï¼‰ |
| `DataAccessLayer\Model\IDataColumn.cs` | å­—æ®µç»“æ„æ¥å£ |
| `DataAccessLayer\Model\IDataIndex.cs` | ç´¢å¼•ç»“æ„æ¥å£ |
| `DataAccessLayer\MetaData\DbMetaData_Positive.cs` | æ­£å‘å·¥ç¨‹ |
| `DataAccessLayer\MetaData\DbMetaData_Negative.cs` | åå‘å·¥ç¨‹ |
| `DataAccessLayer\Model\ModelHelper.cs` | XML åºåˆ—åŒ– |
| `Configuration\TableItem.cs` | è¡¨å…ƒæ•°æ®ï¼ˆä¸å¯å˜ï¼‰ |
| `Shards\TimeShardPolicy.cs` | æ—¶é—´åˆ†è¡¨ç­–ç•¥ |

---

## ä¸ƒã€æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **å›½äº§åŸåˆ›**ï¼šå®Œå…¨ç”±å›½äººå¼€å‘ï¼Œæœªå¼•ç”¨ä»»ä½•ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œè‡ªä¸»å¯æ§
2. **IDataTable æ˜¯æ ¸å¿ƒ**ï¼šä¸æ˜¯ XMLï¼ŒIDataTable æ‰æ˜¯è¡”æ¥æ•°æ®åº“ã€å®ä½“ç±»ã€XML çš„ä¸­æ¢
3. **åŒå‘æ˜ å°„**ï¼šæ¯ç§æ•°æ®åº“æœ‰ç‹¬ç«‹çš„ç±»å‹æ˜ å°„è§„åˆ™ï¼ŒRawType ä¿è¯è·¨åº“å…¼å®¹
4. **è¿è¡Œæ—¶å¯å˜**ï¼šTableItem ä¸å¯å˜è®°å½•åŸå§‹è®¾å®šï¼ŒIDataTable å¯å˜æ”¯æŒåŠ¨æ€è°ƒæ•´
5. **é›¶è¿ç§»æ–‡ä»¶**ï¼šä¸åŒäº EF çš„è¿ç§»æ¨¡å¼ï¼ŒXCode è¿è¡Œæ—¶è‡ªåŠ¨å¯¹æ¯”åŒæ­¥
6. **åŠ¨æ€åˆ†è¡¨åˆ†åº“**ï¼šè¿è¡Œæ—¶ä¿®æ”¹è¡¨å/è¿æ¥åï¼Œæ˜¯ XCode çš„æ ¸å¿ƒäº®ç‚¹
7. **å…¼å®¹ Dapper**ï¼šæ”¯æŒä»»æ„ SQL æ˜ å°„ï¼ŒåŒæ—¶å…·å¤‡ç¼“å­˜ã€è¯»å†™åˆ†ç¦»ã€é“¾è·¯è¿½è¸ªèƒ½åŠ›

### æ¡†æ¶å®šä½å·®å¼‚

| æ¡†æ¶ | æ ¸å¿ƒç†å¿µ | å›½äº§ |
|------|---------|------|
| **XCode** | é›¶é…ç½®ã€è¿è¡Œæ—¶çµæ´»ã€è·¨åº“éƒ¨ç½²ã€åŠ¨æ€åˆ†è¡¨åˆ†åº“ | âœ… åŸåˆ› |
| **EF Core** | è¿ç§»å†å²å¯è¿½æº¯ã€å›¢é˜Ÿåä½œã€ç‰ˆæœ¬ç®¡ç† | âŒ |
| **FreeSql/SqlSugar** | è½»é‡æ˜“ç”¨ã€è‡ªåŠ¨åŒæ­¥ã€å›½äº§ç”Ÿæ€ | âœ… |
| **Dapper** | æç®€ã€æ‰‹å†™ SQLã€é«˜æ€§èƒ½ | âŒ |

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0  
**æ›´æ–°æ—¥æœŸ**ï¼š2026-02-02  
**é€‚ç”¨ç‰ˆæœ¬**ï¼šXCode 11.x+

