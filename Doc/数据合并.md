# 数据合并

梳理不同场景下，合并不同数据源并更新到数据库的要点。魔方的添加和更新，数据导入，备份恢复等。

## 添加Add

表单填写数据作为来源参数传入

| 来源        | 读脏数据 | 字段匹配 | 取值   | 赋值   | 备注                                          |
| ----------- | -------- | -------- | ------ | ------ | --------------------------------------------- |
| IEntity实体 | 是       | 无       | 无     | 无     | 入参就是实体对象，实体工厂创建后由MVC绑定填充 |
| IModel模型  | 否       | 反射     | 索引器 | 索引器 | 属性层面反射匹配字段，IModel取值              |
| 其它对象    | 否       | 反射     | 反射   | 反射   | 属性层面反射匹配字段，反射赋值                |

## 更新Update

| 来源        | 读脏数据 | 字段匹配 | 取值   | 赋值   | 备注                                  |
| ----------- | -------- | -------- | ------ | ------ | ------------------------------------- |
| IEntity实体 | 是       | 无       | 无     | 无     | 入参就是实体，主键查找后有MVC绑定填充 |
| IModel模型  | 否       | 反射     | 索引器 | 索引器 | 属性层面反射匹配字段，IModel取值      |
| 其它对象    | 否       | 反射     | 反射   | 反射   | 属性层面反射匹配字段，反射赋值        |

## 合并Merge

| 来源            | 读脏数据 | 字段匹配 | 取值   | 赋值    | 备注                                            |
| --------------- | -------- | -------- | ------ | ------- | ----------------------------------------------- |
| 数据分析new实体 | 是       | 工厂字段 | 索引器 | SetItem | 常见于数据分析，新版本数据覆盖旧版本            |
| Excel文件导入   | 否       | 工厂字段 | 索引器 | SetItem | Excel导入，需要根据主键或主索引匹配，更新或插入 |
| Zip文件导入     | 否       | 工厂字段 | 索引器 | SetItem | Zip导入，数据迁移，一般带有主键，更新或插入     |
| 备份恢复        | 否       | 否       | 否     | 否      | 直接批量Insert                                  |

